# Домашнее задание к занятию 17 «Инцидент-менеджмент»


# Postmortem: Инцидент GitHub от 21 октября 2018 года

---

## Краткое описание инцидента  
21 октября 2018 года GitHub столкнулся с масштабным инцидентом, вызванным кратковременным сбоем связи между дата-центрами на Восточном и Западном побережьях США. Это привело к автоматическому переносу основного кластера баз данных, в результате чего пользователи наблюдали устаревшие или неполные данные на GitHub.com. Пользовательские данные не были утеряны. Полное восстановление системы заняло 24 часа и 11 минут.

---

## Предшествующие события  
В рамках планового технического обслуживания в дата-центре на Восточном побережье проводилась замена оптического оборудования, что привело к кратковременному (43 секунды) перерыву связи между ЦОДами.

---

## Архитектура (бэкграунд)  
GitHub использует собственную инфраструктуру, размещённую в нескольких географически распределённых дата-центрах. Для управления кластерами и маршрутизацией используется оркестратор, автоматически реагирующий на события отказа.  
Обычно один кластер баз данных является **первичным** и принимает все операции записи, тогда как остальные работают в режиме репликации.

![normal](https://github.com/user-attachments/assets/4f50d20d-fa3c-4d15-ac3e-39363af93042)

---

## Причина инцидента  
Кратковременная потеря связи была интерпретирована оркестратором как отказ Восточного ЦОД. В результате основной кластер БД был перенесён на Западное побережье. При этом:

- Задержки при записи резко увеличились из-за сетевой удалённости.  
- Началась запись данных в новый кластер, в то время как старый ещё не синхронизировался.  
- Это привело к несогласованности между базами данных и устаревшей информации на сайте.

![ivalid](https://github.com/user-attachments/assets/439581c5-07aa-4ccd-a4cb-a3ecab8aaedb)

---

## Воздействие

- Некоторые Issues и комментарии, отправленные пользователями, не отображались.  
- Вебхуки не срабатывали.  
- Отображаемые данные могли быть неполными или устаревшими.  
- Работа сборок (CI/CD) была приостановлена.  

---

## Обнаружение

- **2018-10-21 22:54 UTC** — системы мониторинга зафиксировали рост ошибок.  
- Дежурные инженеры начали расследование.  
- **23:02 UTC** — была установлена причина: несогласованность данных в результате миграции кластера.

---

## Реакция

- Было приостановлено внесение новых данных во избежание дальнейшей деградации.  
- Принято решение вручную восстановить основной кластер на Восточном побережье.  
- Для ускорения восстановления временно отключены вебхуки и автоматические сборки.

---

## Восстановление  
Сотрудники GitHub вручную восстановили прежнюю топологию кластера, провели синхронизацию данных между регионами и протестировали целостность. После этого сервис был полностью возвращён в штатный режим. Все отложенные операции (вебхуки и сборки) были выполнены.  

![recovery](https://github.com/user-attachments/assets/6acdb9fe-bf48-4d2a-80da-233e905c83eb)

---


## Таймлайн

2018-10-21 22:52 UTC — кратковременная потеря связи между ЦОДами (43 сек).
2018-10-21 22:54 UTC — системы мониторинга регистрируют ошибки.
2018-10-21 23:02 UTC — установлено, что причина — несогласованные данные.
2018-10-21 23:07 UTC — задействована команда реагирования, блокировка изменений.
2018-10-21 23:13 UTC — принято решение о восстановлении Восточного кластера.
2018-10-21 23:19 UTC — временно остановлены вебхуки и сборки.
2018-10-22 00:05 UTC — начаты работы по восстановлению.
2018-10-22 00:41 UTC — начинается восстановление кластера.
2018-10-22 06:51 UTC — репликация данных началась.
2018-10-22 11:12 UTC — восстановлены все приоритетные базы данных.
2018-10-22 16:24 UTC — завершена репликация.
2018-10-22 16:45 UTC — начата обработка вебхуков из бэклога.
2018-10-22 23:03 UTC — все вебхуки и сборки обработаны.

---

## Последующие действия и улучшения

Инцидент позволил выявить критические слабые места в архитектуре отказоустойчивости. GitHub инициировал следующие изменения:

- **Изменение поведения оркестратора**: исключено автоматическое перемещение первичных баз данных за пределы региона.  
- **Новая система оповещений**: ускорена миграция на более надёжную и масштабируемую систему уведомлений.  
- **Повышенная отказоустойчивость**: инициированы проекты, обеспечивающие автоматическое восстановление сервисов без вмешательства пользователя.  
- **Регулярное тестирование**: внедрены циклы проверок, стресс-тестов и учений по восстановлению после сбоев.

---


